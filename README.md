# YOLO

YOLO is a deployment tool inspired by Laravel Vapor CLI. 

YOLO sits approximately in between Laravel Forge and Laravel Vapor. It creates highly available resources on AWS, but uses EC2 instead of Lambda.

The goal is to heavily leverage AWS, and support moderate to very heavy traffic web apps. 

___
### Prerequisites
YOLO uses AWS profiles for authentication, so before getting started, install the AWS CLI tool.

## Installation

### Install With Composer
```bash
composer require codinglabsau/yolo
```

You should also gitignore the `.yolo` build directory.

## Usage
The entry point for YOLO is `vendor/bin/yolo` or `yolo` if you have `./vendor/bin` in your path.

### Permissions & Authentication
YOLO uses AWS profiles stored in `~/.aws/credentials` for authentication. You'll need to set a `YOLO_{ENVIRONMENT}_AWS_PROFILE` in the app `.env` file to point to the correct profile; eg. `YOLO_PRODUCTION_AWS_PROFILE=my-project-profile`.

Once configured, future operations will authenticate using the profile.

Note that for CI environments, `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` are used instead. Ensure that any access keys provided in CI are using least-privileged scope as a safety guard against accidental AWS resource modification.

### `yolo init`
Initalises the yolo.yml file in the app with a boilerplate production environment.

### `yolo sync`
Runs through a series of commands to provision all required resources to AWS. The sub-commands are:
- `yolo sync:network <environment>` prepares the VPC, subnets and security groups
- `yolo sync:ci <environment>` prepares the continuous integration pipeline
- `yolo sync:compute <environment>` prepares the compute resources
- `yolo sync:landlord <environment>` prepares landlord resources (multitenancy apps only)
- `yolo sync:tenant <environment>` prepares tenant resources (multitenancy apps only)
- `yolo sync:iam <environment>` prepares `github-<environment>` user for CI and `yolo-<environment>` EC2 role

### `yolo ami:create <environment>`
With all low-level resource provisioned, the next step is to create an AMI for EC2s. All server types will utilise this AMI.

### `yolo prepare <environment>`
Prepares autoscaling groups, EC2 launch template and alarms. 

Requires the `--ami-id` option to specify the target AMI.

### `yolo env:push <environment>`
Prior to building the environment, you'll need to create `.env.<environment>` followed by `yolo env:push <environment>`.

### `yolo build <environment>`
The build command takes care of building a deployment-ready directory in `./yolo`. 

### `yolo deploy <environment>`
The build command takes care of building and deploying. You can run this locally, or in CI. The deploy command will call the build step for you if a local build does not exist. 

## Full yolo.yml example
This is a complete yolo.yml file, showing default values where applicable. 

Note that some keys are intentionally omitted from the stub generated by `yolo init`. 

```yaml
name: codinglabs

environments:
  production:
    aws:
      region: ap-southeast-2
      bucket: 
      cloudfront:
      alb:
      sns-topic:
      security-group-id:
      transcoder: false
      autoscaling:
        web: 
        queue: 
        scheduler: 
      ec2:
        os-image-id:
        instance-type: t3.small
        instance-profile:
        octane: true
    
    build:
      - composer install --no-cache --no-interaction --optimize-autoloader --no-progress --classmap-authoritative --no-dev
      - npm ci
      - npm run build
      - rm -rf package-lock.json resources/js resources/css node_modules database/seeders database/factories resources/seeding

    domain: codinglabs.com.au
    www: false
    pulse-worker: false
    mysqldump: false
    
    deploy:
      - php artisan migrate --force

    deploy-all:
      - php artisan optimize
```

## Credits
- [Steve Thomas](https://github.com/stevethomas)
- [All Contributors](https://github.com/codinglabsau/yolo/contributors)

## License
Proprietary.
